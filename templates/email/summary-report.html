<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Konveyor Weekly Summary Report</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #24292e;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f6f8fa;
        }
        .container {
            background-color: #ffffff;
            border-radius: 6px;
            padding: 30px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12);
        }
        .header {
            text-align: center;
            border-bottom: 3px solid #0366d6;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .header h1 {
            margin: 0;
            color: #0366d6;
            font-size: 26px;
        }
        .header p {
            margin: 5px 0 0;
            color: #586069;
            font-size: 14px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f6f8fa;
            border-radius: 6px;
            border-left: 4px solid #0366d6;
        }
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0 0 15px;
            color: #24292e;
        }
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .metric {
            background-color: #ffffff;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e1e4e8;
        }
        .metric-label {
            font-size: 12px;
            color: #586069;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .metric-value {
            font-size: 24px;
            font-weight: 600;
            color: #24292e;
            margin: 5px 0;
        }
        .progress-bar {
            width: 100%;
            height: 24px;
            background-color: #e1e4e8;
            border-radius: 12px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #34d058 0%, #28a745 100%);
            transition: width 0.3s ease;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .status-on-track {
            background-color: #28a745;
            color: #ffffff;
        }
        .status-needs-attention {
            background-color: #ffd33d;
            color: #24292e;
        }
        .status-critical {
            background-color: #d73a49;
            color: #ffffff;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e1e4e8;
        }
        th {
            background-color: #f6f8fa;
            font-weight: 600;
            font-size: 12px;
            color: #586069;
            text-transform: uppercase;
        }
        .footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e1e4e8;
            text-align: center;
            color: #586069;
            font-size: 12px;
        }
        .maintainer-row {
            border-bottom: 1px solid #e1e4e8;
        }
        .repo-tags {
            margin-top: 5px;
        }
        .repo-tag {
            display: inline-block;
            background-color: #f6f8fa;
            padding: 3px 8px;
            margin: 2px;
            border-radius: 3px;
            font-size: 11px;
            color: #586069;
            border: 1px solid #e1e4e8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Konveyor Weekly Summary Report</h1>
            <p>Team-wide summary for leadership â€¢ Week ending {{.WeekEnding}}</p>
            <p style="font-size: 12px; margin-top: 10px; color: #d73a49;">
                This is a summary report for oversight. Individual maintainers receive detailed reports for their repositories.
            </p>
        </div>

        <!-- Team Overview Metrics -->
        <div class="section">
            <h2 class="section-title">Team Overview</h2>
            <div class="metric-grid">
                <div class="metric">
                    <div class="metric-label">Total Repositories</div>
                    <div class="metric-value">{{.TotalRepos}}</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Active Maintainers</div>
                    <div class="metric-value">{{.TotalMaintainers}}</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Total Stale Items</div>
                    <div class="metric-value">{{.TotalStaleItems}}</div>
                </div>
                <div class="metric">
                    <div class="metric-label">New Contributors</div>
                    <div class="metric-value">{{.TotalNewContributors}}</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Open Issues</div>
                    <div class="metric-value">{{.TotalOpenIssues}}</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Open PRs</div>
                    <div class="metric-value">{{.TotalOpenPRs}}</div>
                </div>
            </div>
        </div>

        {{if .GoalsProgress}}
        <div class="section">
            <h2 class="section-title">Team Goals Progress</h2>
            <p style="color: #586069; font-size: 14px; margin-bottom: 20px;">
                Tracking progress across all {{.GoalsProgress.TotalReposChecked}} repositories
            </p>

            <!-- Goal 1: 30-Day Activity Rule -->
            <div style="margin-bottom: 25px; padding: 15px; background: #ffffff; border-radius: 6px; border: 1px solid #e1e4e8;">
                <h3 style="font-size: 15px; margin: 0 0 10px 0; color: #24292e;">
                    1. 30-Day Activity Rule
                    <span class="status-badge status-{{.GoalsProgress.ThirtyDayActivity.Status}}">
                        {{.GoalsProgress.ThirtyDayActivity.Status}}
                    </span>
                </h3>
                <p style="font-size: 13px; color: #586069; margin-bottom: 10px;">
                    Goal: No open issue/PR should go >30 days without maintainer comment
                </p>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{printf "%.1f" .GoalsProgress.ThirtyDayActivity.ComplianceRate}}%"></div>
                </div>
                <div style="margin-top: 8px; font-size: 14px; color: #24292e;">
                    <strong>{{printf "%.1f" .GoalsProgress.ThirtyDayActivity.ComplianceRate}}%</strong> compliant
                    ({{.GoalsProgress.ThirtyDayActivity.ItemsOver30Days}} of {{.GoalsProgress.ThirtyDayActivity.TotalOpenItems}} items need attention)
                </div>
                {{if .GoalsProgress.ThirtyDayActivity.WorstOffenders}}
                <details style="margin-top: 10px;">
                    <summary style="cursor: pointer; color: #0366d6; font-size: 13px;">Top {{len .GoalsProgress.ThirtyDayActivity.WorstOffenders}} worst offenders ({{.GoalsProgress.ThirtyDayActivity.ItemsOver30Days}} total)</summary>
                    <ul style="margin-top: 10px; padding-left: 20px; font-size: 13px;">
                        {{range .GoalsProgress.ThirtyDayActivity.WorstOffenders}}
                        <li style="margin-bottom: 5px;">
                            <a href="{{.URL}}" style="color: #0366d6; text-decoration: none;">{{.Org}}/{{.Repo}} #{{.Number}}</a> - {{.DaysSinceUpdate}} days
                        </li>
                        {{end}}
                    </ul>
                    {{if gt .GoalsProgress.ThirtyDayActivity.ItemsOver30Days (len .GoalsProgress.ThirtyDayActivity.WorstOffenders)}}
                    <p style="margin-top: 10px; font-style: italic; color: #586069; font-size: 13px;">
                        <a href="https://github.com/issues?q=org%3Akonveyor+is%3Aopen+updated%3A%3C{{.GoalsProgress.FetchedAt.AddDate 0 0 -30 | formatDate}}+sort%3Aupdated-asc" style="color: #0366d6; text-decoration: none;">View all stale items on GitHub â†’</a>
                    </p>
                    {{end}}
                </details>
                {{end}}
            </div>

            <!-- Goal 2: Backlog Cleanup -->
            <div style="margin-bottom: 25px; padding: 15px; background: #ffffff; border-radius: 6px; border: 1px solid #e1e4e8;">
                <h3 style="font-size: 15px; margin: 0 0 10px 0; color: #24292e;">
                    2. Backlog Cleanup (90+ days)
                    <span class="status-badge status-{{.GoalsProgress.BacklogCleanup.Status}}">
                        {{.GoalsProgress.BacklogCleanup.Status}}
                    </span>
                </h3>
                <p style="font-size: 13px; color: #586069; margin-bottom: 10px;">
                    Goal: Reduce stale backlog by 20% over 4 weeks (baseline: {{.GoalsProgress.BacklogCleanup.Baseline}} on {{.GoalsProgress.BacklogCleanup.BaselineDate}})
                </p>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{if lt .GoalsProgress.BacklogCleanup.ReductionPercent 0.0}}0{{else if gt .GoalsProgress.BacklogCleanup.ReductionPercent 100.0}}100{{else}}{{printf "%.1f" .GoalsProgress.BacklogCleanup.ReductionPercent}}{{end}}%"></div>
                </div>
                <div style="margin-top: 8px; font-size: 14px; color: #24292e;">
                    {{if lt .GoalsProgress.BacklogCleanup.ItemsReduced 0}}
                    <strong style="color: #d73a49;">{{printf "%.1f" (absFloat .GoalsProgress.BacklogCleanup.ReductionPercent)}}%</strong> increase ({{abs .GoalsProgress.BacklogCleanup.ItemsReduced}} items added)
                    {{else}}
                    <strong>{{printf "%.1f" .GoalsProgress.BacklogCleanup.ReductionPercent}}%</strong> reduction achieved ({{.GoalsProgress.BacklogCleanup.ItemsReduced}} items reduced)
                    {{end}}
                </div>
                <div style="margin-top: 5px; font-size: 12px; color: #586069;">
                    Current: {{.GoalsProgress.BacklogCleanup.CurrentBacklog}} items â€¢ {{.GoalsProgress.BacklogCleanup.TimeRemaining}}
                </div>
            </div>

            <!-- Goal 3: Triage Speed -->
            <div style="margin-bottom: 25px; padding: 15px; background: #ffffff; border-radius: 6px; border: 1px solid #e1e4e8;">
                <h3 style="font-size: 15px; margin: 0 0 10px 0; color: #24292e;">
                    3. Triage Speed (72 hours)
                    <span class="status-badge status-{{.GoalsProgress.TriageSpeed.Status}}">
                        {{.GoalsProgress.TriageSpeed.Status}}
                    </span>
                </h3>
                <p style="font-size: 13px; color: #586069; margin-bottom: 10px;">
                    Goal: 100% of new issues triaged (labeled + assigned) within 72 hours
                </p>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{printf "%.1f" .GoalsProgress.TriageSpeed.TriageRate}}%"></div>
                </div>
                <div style="margin-top: 8px; font-size: 14px; color: #24292e;">
                    <strong>{{printf "%.1f" .GoalsProgress.TriageSpeed.TriageRate}}%</strong> triaged
                    ({{.GoalsProgress.TriageSpeed.TriagedIssues}} of {{.GoalsProgress.TriageSpeed.NewIssuesLast72h}} new issues)
                </div>
                {{if .GoalsProgress.TriageSpeed.UntriagedList}}
                <details style="margin-top: 10px;">
                    <summary style="cursor: pointer; color: #0366d6; font-size: 13px;">Untriaged issues ({{len .GoalsProgress.TriageSpeed.UntriagedList}})</summary>
                    <ul style="margin-top: 10px; padding-left: 20px; font-size: 13px;">
                        {{range $index, $issue := .GoalsProgress.TriageSpeed.UntriagedList}}
                        {{if lt $index 10}}
                        <li style="margin-bottom: 5px;">
                            <a href="{{$issue.URL}}" style="color: #0366d6; text-decoration: none;">{{$issue.Org}}/{{$issue.Repo}} #{{$issue.Number}}</a> - {{formatHours $issue.HoursOpen}}
                            {{if and $issue.MissingLabel $issue.MissingAssignee}}<span style="color: #d73a49;">(needs triage)</span>{{else if $issue.MissingLabel}}<span style="color: #d73a49;">(needs label)</span>{{else if $issue.MissingAssignee}}<span style="color: #d73a49;">(needs assignee)</span>{{end}}
                        </li>
                        {{end}}
                        {{end}}
                        {{if gt (len .GoalsProgress.TriageSpeed.UntriagedList) 10}}
                        <li style="margin-top: 10px; font-style: italic; color: #586069;">
                            <a href="https://github.com/search?q=org%3Akonveyor+is%3Aissue+is%3Aopen+no%3Alabel+no%3Aassignee" style="color: #0366d6; text-decoration: none;">View all untriaged issues on GitHub â†’</a>
                        </li>
                        {{end}}
                    </ul>
                </details>
                {{end}}
            </div>

            <!-- Goal 4: Ownership Files -->
            <div style="margin-bottom: 25px; padding: 15px; background: #ffffff; border-radius: 6px; border: 1px solid #e1e4e8;">
                <h3 style="font-size: 15px; margin: 0 0 10px 0; color: #24292e;">
                    4. Ownership File Updates
                    <span class="status-badge status-{{.GoalsProgress.OwnershipUpdates.Status}}">
                        {{.GoalsProgress.OwnershipUpdates.Status}}
                    </span>
                </h3>
                <p style="font-size: 13px; color: #586069; margin-bottom: 10px;">
                    Goal: All repositories have OWNERS and README files
                </p>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{printf "%.1f" .GoalsProgress.OwnershipUpdates.ComplianceRate}}%"></div>
                </div>
                <div style="margin-top: 8px; font-size: 14px; color: #24292e;">
                    <strong>{{printf "%.1f" .GoalsProgress.OwnershipUpdates.ComplianceRate}}%</strong> compliant
                    ({{.GoalsProgress.OwnershipUpdates.ReposWithFiles}} of {{.GoalsProgress.OwnershipUpdates.TotalRepos}} repos)
                </div>
                {{if .GoalsProgress.OwnershipUpdates.ReposNeedingAttention}}
                <details style="margin-top: 10px;">
                    <summary style="cursor: pointer; color: #0366d6; font-size: 13px;">Repos needing files ({{len .GoalsProgress.OwnershipUpdates.ReposNeedingAttention}})</summary>
                    <ul style="margin-top: 10px; padding-left: 20px; font-size: 13px;">
                        {{range .GoalsProgress.OwnershipUpdates.ReposNeedingAttention}}
                        <li style="margin-bottom: 5px;">
                            <a href="{{.URL}}" style="color: #0366d6; text-decoration: none;">{{.Org}}/{{.Repo}}</a>
                            {{if not .HasOwners}}<span style="color: #d73a49;">(missing OWNERS)</span>{{end}}
                            {{if not .HasReadme}}<span style="color: #d73a49;">(missing README)</span>{{end}}
                        </li>
                        {{end}}
                    </ul>
                </details>
                {{end}}
            </div>

            <p style="font-size: 12px; color: #586069; margin-top: 15px; text-align: center;">
                Data fetched: {{.GoalsProgress.FetchedAt.Format "2006-01-02 15:04 MST"}}
            </p>
        </div>
        {{end}}

        <!-- Top Action Items Across All Repos -->
        {{if or .TopUnrespondedIssues .TopUnreviewedPRs}}
        <div class="section">
            <h2 class="section-title">Top Action Items Requiring Attention</h2>
            <p style="color: #586069; font-size: 13px; margin-bottom: 15px; font-style: italic;">
                Priority: ðŸ”´ Urgent (>30 days) â€¢ ðŸŸ¡ Needs attention (7-30 days) â€¢ âšª Recent (<7 days)
            </p>

            {{if .TopUnrespondedIssues}}
            <div style="margin-bottom: 20px;">
                <h3 style="font-size: 16px; margin: 0 0 10px 0; color: #d73a49;">
                    Issues Without Response (Top {{len .TopUnrespondedIssues}})
                </h3>
                <table style="width: 100%; font-size: 13px; border-collapse: collapse;">
                    <thead>
                        <tr style="border-bottom: 2px solid #e1e4e8;">
                            <th style="text-align: left; padding: 8px; color: #586069; font-weight: 600;">Repository</th>
                            <th style="text-align: left; padding: 8px; color: #586069; font-weight: 600;">Issue</th>
                            <th style="text-align: left; padding: 8px; color: #586069; font-weight: 600;">Author</th>
                            <th style="text-align: center; padding: 8px; color: #586069; font-weight: 600;">Age</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .TopUnrespondedIssues}}
                        <tr style="border-bottom: 1px solid #e1e4e8;">
                            <td style="padding: 8px;">
                                <a href="https://github.com/{{.Org}}/{{.Repo}}" style="color: #0366d6; text-decoration: none; font-size: 12px;">{{.Org}}/{{.Repo}}</a>
                            </td>
                            <td style="padding: 8px;">
                                <a href="{{.URL}}" style="color: #0366d6; text-decoration: none; font-weight: 500;">
                                    #{{.Number}}
                                </a>
                                <br>
                                <span style="color: #586069; font-size: 11px;">{{.Title}}</span>
                            </td>
                            <td style="padding: 8px;">
                                <span style="color: #586069;">@{{.Author}}</span>
                            </td>
                            <td style="padding: 8px; text-align: center;">
                                <span style="font-size: 14px;">{{urgencyIndicator .DaysSince}}</span>
                                <span style="color: {{urgencyColor .DaysSince}}; font-weight: 600;">{{.DaysSince}}d</span>
                            </td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
            {{end}}

            {{if .TopUnreviewedPRs}}
            <div style="margin-bottom: 20px;">
                <h3 style="font-size: 16px; margin: 0 0 10px 0; color: #d97706;">
                    Pull Requests Awaiting Review (Top {{len .TopUnreviewedPRs}})
                </h3>
                <table style="width: 100%; font-size: 13px; border-collapse: collapse;">
                    <thead>
                        <tr style="border-bottom: 2px solid #e1e4e8;">
                            <th style="text-align: left; padding: 8px; color: #586069; font-weight: 600;">Repository</th>
                            <th style="text-align: left; padding: 8px; color: #586069; font-weight: 600;">Pull Request</th>
                            <th style="text-align: left; padding: 8px; color: #586069; font-weight: 600;">Author</th>
                            <th style="text-align: center; padding: 8px; color: #586069; font-weight: 600;">Age</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .TopUnreviewedPRs}}
                        <tr style="border-bottom: 1px solid #e1e4e8;">
                            <td style="padding: 8px;">
                                <a href="https://github.com/{{.Org}}/{{.Repo}}" style="color: #0366d6; text-decoration: none; font-size: 12px;">{{.Org}}/{{.Repo}}</a>
                            </td>
                            <td style="padding: 8px;">
                                <a href="{{.URL}}" style="color: #0366d6; text-decoration: none; font-weight: 500;">
                                    #{{.Number}}
                                </a>
                                <br>
                                <span style="color: #586069; font-size: 11px;">{{.Title}}</span>
                            </td>
                            <td style="padding: 8px;">
                                <span style="color: #586069;">@{{.Author}}</span>
                            </td>
                            <td style="padding: 8px; text-align: center;">
                                <span style="font-size: 14px;">{{urgencyIndicator .DaysSince}}</span>
                                <span style="color: {{urgencyColor .DaysSince}}; font-weight: 600;">{{.DaysSince}}d</span>
                            </td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
            {{end}}
        </div>
        {{end}}

        <!-- Maintainer Breakdown -->
        <div class="section">
            <h2 class="section-title">Maintainer Breakdown</h2>
            <p style="color: #586069; font-size: 13px; margin-bottom: 10px;">
                Summary of all {{.TotalMaintainers}} maintainers who received individual reports this week (sorted by stale items count)
            </p>
            <table style="width: 100%; font-size: 13px; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 2px solid #d1d5da;">
                        <th style="text-align: left; padding: 10px;">Maintainer</th>
                        <th style="text-align: center; padding: 10px;">Repos</th>
                        <th style="text-align: center; padding: 10px;">Stale Items</th>
                        <th style="text-align: left; padding: 10px;">Repositories</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .Maintainers}}
                    <tr class="maintainer-row">
                        <td style="padding: 10px;">
                            <strong>{{.Name}}</strong><br>
                            <span style="color: #586069; font-size: 11px;">{{.Email}}</span>
                        </td>
                        <td style="padding: 10px; text-align: center;">
                            {{.RepoCount}}
                        </td>
                        <td style="padding: 10px; text-align: center;">
                            {{if gt .StaleItems 0}}
                            <span style="color: #d73a49; font-weight: 600;">{{.StaleItems}}</span>
                            {{else}}
                            <span style="color: #28a745; font-weight: 600;">0</span>
                            {{end}}
                        </td>
                        <td style="padding: 10px;">
                            <div class="repo-tags">
                                {{range .Repositories}}
                                <span class="repo-tag">{{.}}</span>
                                {{end}}
                            </div>
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>

        <div class="footer">
            <p>Generated on {{.GeneratedAt.Format "2006-01-02 15:04:05 MST"}}</p>
            <p>Generated with <a href="https://github.com/konveyor/release-tools">Konveyor Release Tools</a></p>
        </div>
    </div>
</body>
</html>
